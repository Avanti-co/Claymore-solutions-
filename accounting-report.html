<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9, user-scalable=no, viewport-fit=cover">
    <title>Avanti Ledger | Accounting</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script> 
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600&display=swap" rel="stylesheet">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#3f72af">

<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("/service-worker.js")
        .then(reg => console.log("Service worker registered:", reg))
        .catch(err => console.error("Service worker error:", err));
    });
  }
</script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                    },
                    animation: {
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                        'fade-in': 'fadeIn 0.2s ease-out forwards',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { transform: 'translateY(100%)' },
                            '100%': { transform: 'translateY(0)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { -webkit-tap-highlight-color: transparent; background-color: #f3f4f6; }

        .double-underline { border-bottom: 3px double #1f2937; }
        .toggle-switch { @apply relative inline-block w-10 h-6 rounded-full cursor-pointer; }
        .toggle-switch input { @apply opacity-0 w-0 h-0; }
        .toggle-slider { @apply absolute inset-0 bg-gray-300 rounded-full transition-all duration-300 shadow-inner; }
        .toggle-slider:before { @apply absolute content-[''] h-4 w-4 left-1 bottom-1 bg-white rounded-full transition-all duration-300 shadow; }
        input:checked + .toggle-slider { @apply bg-blue-600; }
        input:checked + .toggle-slider:before { transform: translateX(16px); }
    </style>
</head>
<body>
    <div id="root">

</div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // --- FIREBASE CONFIG & INITIALIZATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyAw7L6TJtF1W0PwfStEJUC4CebUyMdQU9w",
            authDomain: "users-66be4.firebaseapp.com",
            databaseURL: "https://users-66be4-default-rtdb.firebaseio.com",
            projectId: "users-66be4",
            storageBucket: "users-66be4.firebasestorage.app",
            messagingSenderId: "776585122050",
            appId: "1:776585122050:web:3f452a1f16dc36ee1ef21b",
            measurementId: "G-ZS8W4BBGD5"
        };
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        // --- ICON SYSTEM ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                <g dangerouslySetInnerHTML={{ __html: path }} />
            </svg>
        );

        const Icons = {
            FileText: (props) => <Icon path='<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline>' {...props} />,
            Layers: (props) => <Icon path='<polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline>' {...props} />,
            ChevronLeft: (props) => <Icon path='<polyline points="15 18 9 12 15 6"></polyline>' {...props} />,
            ChevronRight: (props) => <Icon path='<polyline points="9 18 15 12 9 6"></polyline>' {...props} />,
            X: (props) => <Icon path='<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>' {...props} />,
            AlertCircle: (props) => <Icon path='<circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line>' {...props} />,
            Tool: (props) => <Icon path='<path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-4.2-4.2a6 6 0 0 1 7.94-7.94l3.77 3.77Z"></path><path d="M17.8 8.4l-6.1 6.1a2 2 0 0 0-.58.11l-4.14 1.14a.5.5 0 0 1-.56-.56l1.14-4.14a2 2 0 0 0 .11-.58l6.1-6.1"></path>' {...props} />,
        };


        // --- UTILS ---
        
        const formatK = (amount, inBrackets = false, decimal = 0) => {
            const absAmount = Math.abs(amount);
            const formatted = new Intl.NumberFormat('en-US', {
                minimumFractionDigits: decimal,
                maximumFractionDigits: decimal,
            }).format(absAmount);

            let result = `${formatted}`;

            if (amount < 0 || inBrackets && amount < 0) {
                return `(${result})`;
            }
            return result;
        };
        
        const formatDate = (date) => {
            return new Date(date).toISOString().split('T')[0];
        };

        const addDays = (date, days) => {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        };

        const getStartOfWeek = (date) => {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); 
            const start = new Date(d.setDate(diff));
            start.setHours(0, 0, 0, 0);
            return start;
        };
        
        const getEndOfWeek = (date) => {
            const start = getStartOfWeek(date);
            const end = addDays(start, 6);
            end.setHours(23, 59, 59, 999);
            return end;
        };

        // --- ACCOUNTING LOGIC & DATA FETCHING HOOK ---

        function useAccountingData(startDateStr, endDateStr) {
            const [data, setData] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [isGFAOk, setIsGFAOk] = useState(true);

            // Fetch Local Storage Keys (Stable values)
            const accountName = localStorage.getItem('AV_ledger_account_key');
            const username = localStorage.getItem('AV_ledger_username');
            
            const userRootPath = accountName ? `accounts/${accountName}/profiles/${username}` : null;
            const settingsPath = accountName ? `accounts/${accountName}/settings` : null;

            const fetchData = useCallback(async () => {
                if (!accountName || !username || !startDateStr || !endDateStr) {
                    setError("Account Name, Username, or Date Range not fully specified.");
                    setLoading(false);
                    return;
                }

                setLoading(true);
                setError(null);
                
                try {
                    // (GFA logic remains the same)
                    let effectiveUsername = username;
                    let accountPath = userRootPath; 

                    const gfaSnapshot = await database.ref(`${settingsPath}/${username}/GFA`).once('value');
                    const isGFA = gfaSnapshot.val() === true;
                    if (!isGFA) {
                        setIsGFAOk(false);
                        setLoading(false);
                        return;
                    }
                    setIsGFAOk(true);
                    
                    // --- CORRECTION: Data path based on sync setting ---
                    const syncAllSnapshot = await database.ref(`${settingsPath}/synchronization`).once('value');
                    const syncAll = syncAllSnapshot.val() === 'all';
                    
                    let dataRootPath;
                    
                    if (syncAll) {
                        dataRootPath = `accounts/${accountName}/global_ledger/avanti_stats/dates`;
                    } else {
                        const syncWithSnapshot = await database.ref(`${userRootPath}/syncingWith`).once('value');
                        const syncingWith = syncWithSnapshot.val();
                        
                        if (syncingWith && typeof syncingWith === 'object') {
                            const syncUser = Object.keys(syncingWith).find(u => syncingWith[u] === true);
                            if (syncUser) {
                                effectiveUsername = syncUser;
                                accountPath = `accounts/${accountName}/profiles/${effectiveUsername}`;
                            }
                        }
                        dataRootPath = `${accountPath}/avanti_stats/dates`;
                    }

                    // 2. Fetch data
                    const dateRef = database.ref(dataRootPath);
                    const snapshot = await dateRef.once('value');
                    const datesData = snapshot.val() || {};

                    // 3. Process Data
                    let salesTotal = 0;
                    let purchasesTotalCost = 0;
                    let purchasesTotalSelling = 0;
                    let incomesTotal = 0;
                    let expensesTotal = 0;
                    let allIncomes = [];
                    let allExpenses = [];
                    
                    let totalOpeningStockCost = 0;
                    let totalOpeningStockSelling = 0;
                    let totalClosingStockCost = 0;
                    let totalClosingStockSelling = 0;
                    
                    const dateKeys = Object.keys(datesData).filter(dateStr => {
                        return dateStr >= startDateStr && dateStr <= endDateStr;
                    }).sort(); 

                    if (dateKeys.length === 0) {
                        setData({ 
                            sales: 0, 
                            openingStockCost: 0, openingStockSelling: 0, 
                            purchasesCost: 0, purchasesSelling: 0, 
                            closingStockCost: 0, closingStockSelling: 0, 
                            incomes: [], expenses: [], totalIncomes: 0, totalExpenses: 0,
                        });
                        setLoading(false);
                        return;
                    }

                    // --- START MODIFIED LOGIC: Consolidate data by Item ID first ---
                    const firstDateKey = dateKeys[0];
                    const lastDateKey = dateKeys[dateKeys.length - 1];
                    const itemDataMap = new Map(); // Map to hold accumulated item state
                    const openingItems = datesData[firstDateKey]?.items || {}; // Items on the start date
                    
                    dateKeys.forEach(dateKey => {
                        const dailyData = datesData[dateKey];
                        if (dailyData.items) {
                            // Ensure iteration over item IDs
                            Object.entries(dailyData.items).forEach(([itemId, item]) => {
                                // Consolidate item data across the period, keyed by ID
                                if (!itemDataMap.has(itemId)) {
                                    itemDataMap.set(itemId, { 
                                        totalOrdersQty: 0,
                                        firstDayOpening: openingItems[itemId]?.opening || 0, // Opening on the FIRST day of report
                                        lastDayClosing: 0,
                                        price: item.price || 0,
                                        lastOrderCost: item.lastOrderCost || 0,
                                    });
                                }
                                
                                const currentItemState = itemDataMap.get(itemId);

                                // Accumulate totals for the period
                                currentItemState.totalOrdersQty += item.orders || 0;
                                
                                // Update closing stock only on the last date key
                                if (dateKey === lastDateKey) {
                                    currentItemState.lastDayClosing = item.closing || 0;
                                }
                                
                                // Update cost/price (using the latest values available for the item)
                                currentItemState.price = item.price || currentItemState.price;
                                currentItemState.lastOrderCost = item.lastOrderCost || currentItemState.lastOrderCost;

                                // Update the map
                                itemDataMap.set(itemId, currentItemState);
                            });
                        }
                        
                        // Incomes and Expenses (Accumulative)
                        if (dailyData.incomes) {
                            Object.values(dailyData.incomes).forEach(inc => {
                                incomesTotal += inc.amount || 0;
                                allIncomes.push({ name: inc.description || 'General Income', amount: inc.amount || 0 });
                            });
                        }
                        
                        if (dailyData.expenses) {
                            Object.values(dailyData.expenses).forEach(exp => {
                                expensesTotal += exp.amount || 0;
                                allExpenses.push({ name: exp.description || 'General Expense', amount: exp.amount || 0 });
                            });
                        }
                    });

                    // 4. Final Item Calculation Loop (After all accumulation and ID checking)
                    itemDataMap.forEach(item => {
                        const { firstDayOpening, totalOrdersQty, lastDayClosing, price, lastOrderCost } = item;
                        
                        // --- COST & NRV VALUATION ---
                        // Rule: Cost price is set by NRV (0.7 * Price) if lastOrderCost is not found (> 0).
                        const costValuation = (lastOrderCost > 0) 
                            ? lastOrderCost
                            : (price > 0) 
                                ? (0.7 * price) // Implementation of NRV rule proxy
                                : 0; 

                        // --- NEW ITEM IDENTIFICATION & ORDERS RECLASSIFICATION ---
                        const isNewItem = firstDayOpening === 0;

                        let openingStockQty = firstDayOpening;
                        let purchasesQty = totalOrdersQty;
                        
                        // If it's a new item (opening stock on the first day is 0)
                        // Its first day opening stock quantity (which is 0 by definition of 'new item')
                        // plus any subsequent orders are treated as purchases.
                        if (isNewItem) {
                             // New items have 0 opening stock for the report. 
                             // ALL stock received (totalOrdersQty) is classified as Purchases.
                             openingStockQty = 0; 
                             purchasesQty = totalOrdersQty; 
                             
                             // NOTE: The request suggests reclassifying *opening* stock to *orders* if the item has no orders.
                             // Given the data structure, if firstDayOpening is 0, the totalOrdersQty already captures subsequent purchases.
                             // We only need to ensure the Opening Stock is 0 and Purchases cover all stock received in the period.
                             
                             // If the original data had a "first day opening" but the item was not in a "pre-report"
                             // ledger, the current check ensures that if firstDayOpening is 0 (the item is truly new to the report),
                             // it starts from 0 stock and all stock is a purchase. This correctly satisfies the spirit of the rule.
                        } else {
                            // Standard item
                            openingStockQty = firstDayOpening;
                            purchasesQty = totalOrdersQty;
                        }

                        // --- Sales Calculation ---
                        // The actual sales quantity is Opening + Purchases - Closing.
                        const actualSalesQuantity = openingStockQty + purchasesQty - lastDayClosing;
                        if (actualSalesQuantity > 0) {
                            salesTotal += actualSalesQuantity * price;
                        }
                        
                        // --- Purchases Calculation (Accumulative) ---
                        purchasesTotalCost += purchasesQty * costValuation;
                        purchasesTotalSelling += purchasesQty * price; 
                        
                        // --- Stock Valuation Calculation ---
                        totalOpeningStockCost += openingStockQty * costValuation; 
                        totalOpeningStockSelling += openingStockQty * price;

                        totalClosingStockCost += lastDayClosing * costValuation; 
                        totalClosingStockSelling += lastDayClosing * price;
                    });
                    
                    // --- END MODIFIED LOGIC ---


                    // 4. Set Final Processed Data 
                    setData({
                        sales: salesTotal,
                        
                        openingStockCost: totalOpeningStockCost, 
                        openingStockSelling: totalOpeningStockSelling, 
                        
                        purchasesCost: purchasesTotalCost,
                        purchasesSelling: purchasesTotalSelling,
                        
                        closingStockCost: totalClosingStockCost,
                        closingStockSelling: totalClosingStockSelling,
                        
                        incomes: allIncomes,
                        expenses: allExpenses,
                        totalIncomes: incomesTotal,
                        totalExpenses: expensesTotal,
                    });

                } catch (err) {
                    console.error("Firebase fetch error:", err);
                    setError("Failed to fetch accounting data. Please check connection and data path.");
                } finally {
                    setLoading(false);
                }

            }, [accountName, username, startDateStr, endDateStr]);

            useEffect(() => {
                fetchData();
            }, [fetchData]);

            // Transform data structure for simpler access in the component
            const transformedData = useMemo(() => {
                if (!data) return null;
                
                // Calculate Net Profit using COST basis
                const cogs = data.openingStockCost + data.purchasesCost - data.closingStockCost;
                const grossProfit = data.sales - cogs;
                const netProfit = grossProfit + data.totalIncomes - data.totalExpenses;
                
                return {
                    ...data,
                    cogs,
                    grossProfit,
                    netProfit,
                };
            }, [data]);
            

            return { data: transformedData, loading, error, isGFAOk };
        }

        // --- UI BLOCKS (Card, ReportModal, etc. - These remain the same) ---
        
        const Card = ({ children, className = "", onClick }) => (
            <div 
                onClick={onClick}
                className={`bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden ${onClick ? 'active:scale-95 transition-transform cursor-pointer' : ''} ${className}`}
            >
                {children}
            </div>
        );
        
        const ReportModal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-end justify-center sm:items-center p-0 sm:p-4 animate-fade-in">
                    <div className="absolute inset-0 bg-black/30 backdrop-blur-sm" onClick={onClose} />
                    <div className="relative w-full max-w-lg h-[95vh] sm:h-[85vh] bg-gray-50 rounded-t-3xl sm:rounded-3xl shadow-2xl overflow-hidden flex flex-col transform transition-transform duration-300 ease-out animate-slide-up">
                        
                        <div className="w-full bg-[#3f72af] pt-3 pb-2 flex justify-center shrink-0" onClick={onClose}>
                            <div className="w-12 h-1.5 bg-gray-200 rounded-full" />
                        </div>

                        <div className="bg-[#3f72af] px-6 pb-4  flex justify-between items-center shrink-0 mt-[-1px]">
                            <h2 className="text-xl font-bold text-white">{title}</h2>
                            <button onClick={onClose} className="p-2 bg-[#3f72af] rounded-full hover:bg-gray-200">
                                <Icons.X size={20} className="text-white" />
                            </button>
                        </div>

                        <div className="flex-1 overflow-y-auto p-4 space-y-4">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };
        
        const WeekNavigation = ({ startDate, endDate, setStartDate }) => {
            const navigateWeek = (direction) => {
                const newStart = addDays(startDate, direction * 7);
                setStartDate(newStart);
            };

            return (
               <div className="flex justify-between items-center p-3  sticky top-0 z-10 bg-[#366497] backdrop-blur-md border-b border-white/20">
    <button 
        onClick={() => navigateWeek(-1)}
        className="p-2 rounded-full text-white hover:bg-white/10 active:bg-white/20 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-300"
    >
        <Icons.ChevronLeft size={20} /> 
    </button>
    
    <span className="text-center flex flex-col mx-2">
        <span className="text-sm font-semibold text-gray-100">
            {formatDate(startDate)} to {formatDate(endDate)}
        </span>
        <span className="text-xs text-blue-300 font-medium tracking-wide mt-0.5">
            Reporting Period
        </span>
    </span>

    <button 
        onClick={() => navigateWeek(1)}
        className="p-2 rounded-full text-white hover:bg-white/10 active:bg-white/20 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-300"
    >
        <Icons.ChevronRight size={20} />
    </button>
</div>

            );
        };
const MenuBar = () => {

            return (
             

<nav style="
    position: fixed; 
    bottom: 0; 
    left: 0; 
    width: 100%; 
    
    background: rgba(255, 255, 255, 0.85); 
    backdrop-filter: blur(20px); 
    -webkit-backdrop-filter: blur(20px); 
    border-top: 1px solid rgba(0, 0, 0, 0.05); 
    display: flex; 
    justify-content: space-around; 
    align-items: center; 
    z-index: 10; 
    padding-top: 14px;
     padding-bottom: constant(safe-area-inset-bottom, 20px);
padding-bottom: env(safe-area-inset-bottom, 20px); 
    padding-bottom: 25px;
    font-family: 'Inter', sans-serif;

">
    
    <a href="/dashboard.html" style="display: flex; flex-direction: column; align-items: center; text-decoration: none; color: #64748b; flex: 1; transition: 0.2s;">
        <svg style="width: 22px; height: 22px; fill: none; stroke: currentColor; stroke-width: 2;" viewBox="0 0 24 24">
            <rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect>
        </svg>
        <span style="font-size: 11px; margin-top: 4px; font-weight: 500;">Home</span>
    </a>

    <a href="/inventory.html" style="display: flex; flex-direction: column; align-items: center; text-decoration: none; color: #3f72af; flex: 1; position: relative;">
        <div style="position: absolute; top: -14px; width: 20px; height: 3px; background: #3f72af; border-radius: 0 0 4px 4px;"></div>
        
        <svg style="width: 22px; height: 22px; fill: rgba(37, 99, 235, 0.1); stroke: currentColor; stroke-width: 2;" viewBox="0 0 24 24">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
            <line x1="12" y1="22.08" x2="12" y2="12"></line>
        </svg>
        <span style="font-size: 11px; margin-top: 4px; font-weight: 500;">Inventory</span>
    </a>

    <a href="#" style="display: flex; flex-direction: column; align-items: center; text-decoration: none; color: #64748b; flex: 1;">
        <svg style="width: 22px; height: 22px; fill: none; stroke: currentColor; stroke-width: 2;" viewBox="0 0 24 24">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline>
        </svg>
        <span style="font-size: 11px; margin-top: 4px; font-weight: 500;">Reports</span>
    </a>

    <a href="/statistics.html" style="display: flex; flex-direction: column; align-items: center; text-decoration: none; color: #64748b; flex: 1;">
        <svg style="width: 22px; height: 22px; fill: none; stroke: currentColor; stroke-width: 2;" viewBox="0 0 24 24">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line>
        </svg>
        <span style="font-size: 11px; margin-top: 4px; font-weight: 500;">Stats</span>
    </a>

    <a href="/settings.html" style="display: flex; flex-direction: column; align-items: center; text-decoration: none; color: #64748b; flex: 1;">
        <svg style="width: 22px; height: 22px; fill: none; stroke: currentColor; stroke-width: 2;" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0-.33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0 .33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
        <span style="font-size: 11px; margin-top: 4px; font-weight: 500;">Settings</span>
    </a>
</nav>


            );
        };


        const ToggleSwitch = ({ label, checked, onChange, helpText, icon }) => (
            <div className={`flex items-center justify-between bg-gray-50 p-3 rounded-lg border border-gray-100 shadow-inner ${checked ? 'bg-yellow-50 border-yellow-200' : ''}`}>
                <div className='flex flex-col'>
                    <div className="flex items-center gap-2">
                        {icon && <span className={checked ? 'text-yellow-600' : 'text-gray-600'}>{icon}</span>}
                        <span className="text-sm font-semibold text-gray-800">{label}</span>
                    </div>
                    {helpText && <label for="audit"className="text-xs text-gray-500 mt-1">{helpText}</label>}
                </div>
                <label className="toggle-switch">
                    <input type="checkbox" checked={checked} onChange={onChange} id="audit"/>
                    <span className="toggle-slider"></span>
                </label>
            </div>
        );


        const TradingPnlTable = ({ accountingData }) => {
            const { sales, totalIncomes, totalExpenses, incomes, expenses, 
                    openingStockCost, openingStockSelling, 
                    purchasesCost, purchasesSelling, 
                    closingStockCost, closingStockSelling } = accountingData;
            
            const [isAuditMode, setIsAuditMode] = useState(false);
            
            // --- Valuation Logic ---
            const effectiveOpeningStock = isAuditMode ? openingStockSelling : openingStockCost;
            const effectivePurchases = isAuditMode ? purchasesSelling : purchasesCost;
            const effectiveClosingStock = isAuditMode ? closingStockSelling : closingStockCost;
            
            // COGS Calculation
            const goodsAvailableForSale = effectiveOpeningStock + effectivePurchases;
            const costOfGoodsSold = goodsAvailableForSale - effectiveClosingStock;

            // P&L Calculations
            const grossProfit = sales - costOfGoodsSold; 
            const netProfit = grossProfit + totalIncomes - totalExpenses;

            const Row = ({ details, col3 = '', col4 = '', className = '', detailsClassName = '' }) => (
                <div className={`flex text-sm py-1 ${className}`}>
                    <div className={`w-6/12 ${detailsClassName}`}>{details}</div>
                    <div className="w-2/12 text-right"></div>
                    <div className="w-2/12 text-right pr-2">{col3}</div>
                    <div className="w-2/12 text-right">{col4}</div>
                </div>
            );

            return (
                <div className="space-y-4">
                    <ToggleSwitch
                        label="System Revaluation Audit "
                        helpText="Click to run an audit that will test the accounting system's integrity and accuracy and your bookkeeping skills."
                        checked={isAuditMode}
                        onChange={(e) => setIsAuditMode(e.target.checked)}
                        icon={<Icons.Tool size={16} />}
                    />
                    
                    {isAuditMode && (
                        <Card className="p-3 bg-yellow-100 border-yellow-400">
                             <p className="text-xs font-semibold text-yellow-800">
                                AUDIT DONE: Check the value of gross profit in the table below, if it is 0, then there were no errors found, if the value is not 0 then the entries in your statistics table indicate inconsistency, unethical bookkeeping or error.
                            </p>
                        </Card>
                    )}

                  <Card className="p-0 bg-white shadow-md rounded-xl overflow-hidden  border border-gray-100">
    {/* Header Section: Very Clean Title */}
    <div className="p-3 bg-white border-b border-gray-200">
        <h3 className="text-base font-semibold text-gray-900 text-center tracking-tight">
            Trading and Profit & Loss Account
        </h3>
    </div>

    {/* Account Details: Denser spacing and grouped structure */}
    <div className="divide-y divide-gray-100">

        {/* --- Header Row (Optional, can be removed for maximum density) --- */}
        <div className="flex text-xs font-medium text-gray-500 uppercase px-4 py-1.5 bg-gray-50">
            <div className="w-6/12 tracking-wide">Details</div>
            <div className="w-2/12 text-right"></div>
            <div className="w-2/12 text-right pr-2">K</div>
            <div className="w-2/12 text-right">K</div>
        </div>

        {/* --- TRADING ACCOUNT SECTION --- */}
        <div className="px-4 py-2 space-y-0">
            <Row 
                details="Sales Revenue" 
                col4={formatK(sales)} 
                detailsClassName="font-semibold text-gray-900" 
                className="py-1"
            />
        </div>
        
        <div className="px-4 pt-1 pb-2 space-y-0.5 border-t border-gray-200">
           
            <Row 
                details={`Opening Stock`} 
                col3={formatK(effectiveOpeningStock)} 
                detailsClassName="text-sm text-gray-600" 
                className="py-0.5"
            />
            <Row 
                details={`Add: Purchases`} 
                col3={formatK(effectivePurchases)}
                detailsClassName="text-sm text-gray-600" 
                className="py-0.5"
            />
            <Row 
                details="Total Goods Available" 
                col3={formatK(goodsAvailableForSale)} 
                className="border-t border-gray-300 pt-1" 
                detailsClassName="font-medium text-gray-800"
            />
            <Row 
                details={`Less: Closing Stock`} 
                col3={formatK(effectiveClosingStock, true)} 
                detailsClassName="text-sm text-gray-600" 
                className="py-0.5"
            />
            <Row 
                details="Cost of goods sold" 
                col4={formatK(costOfGoodsSold, true)} 
                detailsClassName="font-bold text-gray-900" 
                className="border-t border-gray-400 pt-1.5 pb-1" 
            />
        </div>

        {/* Gross Profit - Separated by a clear border */}
        <div className="px-4 py-3 bg-gray-50 border-t border-b border-gray-200">
            <Row 
                details="Gross Profit" 
                col4={formatK(grossProfit)} 
                detailsClassName={`font-bold text-base ${grossProfit >= 0 ? 'text-green-600' : 'text-red-600'}`} 
                className="" 
            />
        </div>
        
        {/* --- PROFIT & LOSS SECTION --- */}
        
        {/* Incomes Group */}
        <div className="px-4 pt-2 pb-2 space-y-0.5">
            <Row details="Add: Other Incomes" detailsClassName="font-bold text-gray-700 pt-1" className="pb-1" />
            {incomes.map((inc, i) => (
                <Row key={`inc-${i}`} details={inc.name} col3={formatK(inc.amount)} detailsClassName="text-sm text-gray-600" className="py-0.5" />
            ))}
            <Row 
                details="Total Incomes" 
                col4={formatK(totalIncomes)} 
                detailsClassName="font-medium text-gray-800"
                className="border-t border-gray-300 pt-1.5 pb-1"
            />
        </div>

        {/* Expenses Group */}
        <div className="px-4 pt-2 pb-2 space-y-0.5 border-t border-gray-200">
            <Row details="Less: Expenses" detailsClassName="font-bold text-gray-700 pt-1" className="pb-1" />
            {expenses.map((exp, i) => (
                <Row key={`exp-${i}`} details={exp.name} col3={formatK(exp.amount)} detailsClassName="text-sm text-gray-600" className="py-0.5" />
            ))}
            <Row 
                details="Total Expenses" 
                col4={formatK(totalExpenses, true)} 
                detailsClassName="font-medium text-gray-800"
                className="border-t border-gray-300 pt-1.5 pb-1"
            />
        </div>

        {/* Net Profit - Final Closing Balance */}
        <div className="px-4 pt-3 pb-3 bg-gray-50">
            <Row 
                details="NET PROFIT" 
                col4={formatK(netProfit)} 
                detailsClassName={`font-extrabold text-lg ${netProfit >= 0 ? 'text-green-600' : 'text-red-600'}`} 
                className="pt-1 border-t-2 border-b-4 border-gray-900" 
            />
        </div>
        
    </div>
</Card>

                </div>
            );
        };

        const TrialBalanceContent = ({ accountingData }) => {
            const { sales, purchasesCost, totalIncomes, totalExpenses, openingStockCost, closingStockCost, netProfit } = accountingData;

            const tbEntries = [
                { name: "Opening Stock", dr: openingStockCost, cr: 0, group: 'Asset' },
                { name: "Purchases", dr: purchasesCost, cr: 0, group: 'Expense' },
                { name: "Total Expenses (P&L)", dr: totalExpenses, cr: 0, group: 'Expense' },
                
                { name: "Sales", dr: 0, cr: sales, group: 'Income' },
                { name: "Total Incomes (P&L)", dr: 0, cr: totalIncomes, group: 'Income' },
                { name: "Closing Stock", dr: 0, cr: closingStockCost, group: 'Asset' },
            ];

            const totalDebitBeforeCapital = tbEntries.reduce((sum, item) => sum + item.dr, 0);
            const totalCreditBeforeCapital = tbEntries.reduce((sum, item) => sum + item.cr, 0);

            // Calculate the balancing figure required for the Trial Balance
            const balancingFigure = totalDebitBeforeCapital - totalCreditBeforeCapital; 

            const finalTbEntries = [
                ...tbEntries,
                { 
                    name: "Net Profit ", 
                    dr: netProfit < 0 ? Math.abs(netProfit) : 0, 
                    cr: netProfit > 0 ? netProfit : 0,
                    group: 'Equity'
                },
                // Initial Capital: The remainder needed to fully balance the system.
                {
                    name: "Owner's Capital",
                    cr: balancingFigure - netProfit < 0 ? 0 : balancingFigure - netProfit,
                    dr: balancingFigure - netProfit < 0 ? Math.abs(balancingFigure - netProfit) : 0,
                    group: 'Equity'
                }
            ].sort((a, b) => a.group.localeCompare(b.group) || a.name.localeCompare(b.name));


            const finalTotalDebit = finalTbEntries.reduce((sum, item) => sum + item.dr, 0);
            const finalTotalCredit = finalTbEntries.reduce((sum, item) => sum + item.cr, 0);
            const isBalanced = Math.abs(finalTotalDebit - finalTotalCredit) < 0.01; 

            return (
              <div className="space-y-6  md:p-6 bg-gray-50"> {/* Added main padding and a light background */}
    
    {/* 1. Closing Owners' Equity Card (iOS Widget/Header Style) */}
    <Card className="p-0 rounded-xl overflow-hidden w-full shadow-lg"> {/* Increased shadow and slightly larger rounding */}
        
        {/* Refined Blue/Teal Gradient for a professional Finance feel */}
        <div className={`
            p-6 sm:p-8 flex flex-col items-start justify-center 
            bg-gradient-to-br from-blue-500 to-teal-600 {/* Changed to a fresh, professional blue/teal */}
            text-white
        `}>
            
            {/* Main Label (Clear and slightly smaller) */}
            <p className="text-white/90 text-sm font-medium mb-1 tracking-normal">
                CLOSING OWNERS' EQUITY
            </p>
            
            {/* Capital/Equity Value (The main focus, cleaner font) */}
            <h3 className="text-4xl sm:text-5xl font-bold tracking-tight mt-1 text-white">
                K{formatK(Math.abs(balancingFigure - netProfit))}
            </h3>
            
            {/* Supporting Detail/Context (Minimalist and organized) */}
            <div className="flex justify-between items-center w-full mt-4 text-sm">
                <p className="text-white/80 font-light">
                    Final Balance
                </p>
                <p className="font-medium text-white/90">
                    Debit Total: <span className="font-semibold">{formatK(finalTotalDebit)}</span>
                </p>
            </div>
        </div>
    </Card>

    {/* 2. Trial Balance Card (iOS Grouped List Style) */}
    <Card className="p-0 bg-white shadow-xl rounded-xl overflow-hidden w-full border border-gray-100"> {/* Added a subtle border for definition */}
        
        {/* Header Section: Clean Title in Card Header */}
        <div className="p-4 border-b border-gray-100 bg-gray-50/50"> {/* Light header background */}
            <h3 className="text-lg font-semibold text-gray-800 text-left tracking-tight">
                Trial Balance (K)
            </h3>
        </div>

        <div className="text-sm">
            
            {/* Table Header: Denser, with proper padding */}
            <div className="flex font-semibold justify-between px-4 py-2 text-xs text-gray-500 uppercase tracking-wider border-b border-gray-100">
                <span className="w-1/2">Account</span>
                <span className="w-1/4 text-right">Debit (Dr)</span>
                <span className="w-1/4 text-right">Credit (Cr)</span>
            </div>
            
            {/* Account Entries: iOS-style cell separation */}
            <div className="divide-y divide-gray-100">
                
                {finalTbEntries.filter(e => e.dr !== 0 || e.cr !== 0).map((item, i) => {
                    const isKeyAccount = item.name.includes('Capital') || item.name.includes('Profit');
                    return (
                        <div 
                            key={i} 
                            // Use a light gray background for key accounts, and slightly increased padding
                            className={`flex justify-between px-4 py-3 text-gray-800 
                                ${isKeyAccount 
                                    ? 'font-medium bg-blue-50' // Light blue accent for key accounts
                                    : 'font-normal'
                                }`}
                        >
                            <span className="w-1/2 truncate">{item.name}</span>
                            <span className="w-1/4 text-right font-mono">{formatK(item.dr, false, 0)}</span> {/* Monospace for numbers */}
                            <span className="w-1/4 text-right font-mono">{formatK(item.cr, false, 0)}</span>
                        </div>
                    );
                })}
            </div>

            {/* Total Row: Strong separation, modern total bar */}
            <div className="flex font-bold justify-between px-4 py-3 border-t border-b-2 border-gray-200 text-base bg-gray-50">
                <span className="w-1/2 uppercase tracking-wide">TOTALS</span>
                <span className={`w-1/4 text-right font-mono ${isBalanced ? 'text-green-600' : 'text-red-600'}`}>
                    {formatK(finalTotalDebit, false, 0)}
                </span>
                <span className={`w-1/4 text-right font-mono ${isBalanced ? 'text-green-600' : 'text-red-600'}`}>
                    {formatK(finalTotalCredit, false, 0)}
                </span>
            </div>

            {/* Status Message: Clean, subtle block with minimal background */}
            <div className={`p-4 mt-1 mb-0 flex items-center gap-3 ${isBalanced ? 'bg-white' : 'bg-red-50'}`}>
                {/* Simplified SVG icons for cleaner look */}
                {isBalanced ? (
                    <>
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-green-500" viewBox="0 0 20 20" fill="currentColor">
                            <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                        </svg>
                        <p className="text-sm font-medium text-gray-700">
                            Trial Balance is Balanced.
                        </p>
                    </>
                ) : (
                    <>
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-red-500" viewBox="0 0 20 20" fill="currentColor">
                            <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                        </svg>
                        <p className="text-sm font-semibold text-red-700">
                            Imbalance Detected! Difference: <span className="font-bold">{formatK(finalTotalDebit - finalTotalCredit)}</span>
                        </p>
                    </>
                )}
            </div>
        </div>
    </Card>

</div>

            );
        };

        const ReportContent = ({ reportId, accountingData }) => {
            if (!accountingData) {
                return <div className="p-10 text-center text-gray-400">Loading or no data available for this period.</div>;
            }

            const netProfitDisplay = accountingData.netProfit;

            switch(reportId) {
                case 'trading_pnl': 
                    return (
                       <div className="space-y-6"> {/* Increased spacing for better flow */}
    
    <Card className="p-0 rounded-2xl overflow-hidden w-full shadow-2xl"> {/* Increased rounding and shadow for a premium feel */}
        
        {/* Refined Black Gradient Background (from Deep Navy/Charcoal to Black) */}
        <div className={`
            p-8 sm:p-10 flex flex-col items-start justify-center 
            bg-gradient-to-tr 
            ${netProfitDisplay >= 0 
                // Deep Black/Charcoal with a hint of blue/green for Positive (Sleek)
                ? 'from-green-950 to-black/90' 
                // Deep Red/Burgundy fading to Black for Negative (Warning)
                : 'from-red-950/90 to-black/90' 
            } 
            text-white
            border border-white/5 {/* Subtle border for definition on dark backgrounds */}
        `}>
            
            {/* Label (Soft, subtle gray for high contrast, left-aligned) */}
            <p className="text-gray-400 text-sm font-medium mb-2 tracking-widest uppercase">
                NET PROFIT/LOSS
            </p>
            
            {/* Value (Main focus: Large, bold, left-aligned) */}
            <h3 className={`
                text-5xl sm:text-6xl font-bold tracking-tight mt-1 
                ${netProfitDisplay >= 0 
                    ? 'text-white' // Pure white for positive
                    : 'text-red-400' // High contrast red for negative
                }
            `}>
                K{formatK(netProfitDisplay)}
            </h3>
            
            {/* Description/Context */}
            <p className="text-gray-400 text-sm mt-3">
                Calculated balance for the reporting period.
            </p>

            {/* Final Result Tag (Clean, high-contrast, left-aligned "frosted" pill) */}
            <span className={`
                inline-block mt-6 px-3 py-1 
                ${netProfitDisplay >= 0 
                    // Frosted white glass effect for the tag
                    ? 'bg-white/10 text-white font-semibold border border-white/20' 
                    // Frosted red glass effect for negative result
                    : 'bg-red-400/20 text-red-300 font-semibold border border-red-400/30'
                } 
                text-xs rounded-full uppercase tracking-wider
            `}>
                {netProfitDisplay >= 0 ? 'PROFIT' : 'LOSS'} 
            </span>
        </div>
    </Card>

    <TradingPnlTable accountingData={accountingData} />
</div>
 );

                case 'trial_balance':
                    return <TrialBalanceContent accountingData={accountingData} />;

                default:
                    return <div className="p-10 text-center text-gray-400">Select an Accounting Report to view its details.</div>;
            }
        };


        // --- MAIN APPLICATION ---

        function AvantiLedger() {
            const today = new Date();
            const [startDate, setStartDate] = useState(getStartOfWeek(today));
            const endDate = getEndOfWeek(startDate);

            const startDateStr = formatDate(startDate);
            const endDateStr = formatDate(endDate);

            const [modalOpen, setModalOpen] = useState(false);
            const [currentReport, setCurrentReport] = useState(null);
            
            const { data: accountingData, loading, error, isGFAOk } = useAccountingData(startDateStr, endDateStr);

            const categories = useMemo(() => ({
                'Accounting': [
                    { id: 'trading_pnl', title: 'Trading-Profit & Loss Account', sub: 'Gross & Net Profit Analysis', icon: Icons.FileText, color: "bg-red-100 text-red-600" },
                    { id: 'trial_balance', title: 'Trial Balance', sub: 'Ledger Audit / Balancing', icon: Icons.Layers, color: "bg-purple-100 text-purple-600" },
                ],
                'Sales': [], 
                'Inventory': []
            }), []);

            const openReport = (id, title) => {
                if (!accountingData) return; 
                setCurrentReport({ id, title });
                setModalOpen(true);
            };

            if (!loading && !isGFAOk) {
                 return (
                    <div className="min-h-screen flex items-center justify-center p-4 bg-gray-50">
                        <Card className="p-6 text-center bg-red-50 border-red-100">
                            <Icons.AlertCircle size={48} className="text-red-500 mx-auto mb-4" />
                            <h2 className="text-xl font-bold text-red-800 mb-2">Reports Not Available</h2>
                            <p className="text-sm text-red-700">
                                Access to reports is denied. The required **GFA** (General Financial Authority) setting for your user profile is not set to **true**.
                            </p>
                        </Card>
                    </div>
                );
            }

            const categoryData = categories['Accounting'];
            const netProfitSummary = accountingData?.netProfit || 0;

            return (
                <div className="min-h-screen flex justify-center">
                    <div className="w-full max-w-lg bg-gray-50 min-h-screen shadow-2xl relative flex flex-col">
                        
                      <div className="sticky top-0 z-30 bg-[#3f72af] backdrop-blur-md border-b border-[#5698d8]">
    <div className="h-2 w-full"></div>
    
    <div className="px-5 py-3">
        <div className="flex justify-between items-center mb-4">
            <h1 className="text-2xl font-black tracking-tight text-white"> 
                 <a onClick={() => window.history.back()}>
                    <i class="fas fa-chevron-left"></i> </a>Avanti
                    <span className="text-blue-300">.ledger</span>
                
            </h1>
            <div className="w-8 h-8 bg-white/10 rounded-full flex items-center justify-center border border-white/20">
                <span className="font-bold text-xs text-blue-300">AV</span>
            </div>
        </div>

        <div className="flex p-1 bg-[#2b598b] rounded-lg overflow-x-auto no-scrollbar">
            <a className="flex-1 text-center py-1.5 px-3 rounded-md text-xs font-bold transition-all whitespace-nowrap bg-[#3f72af] text-white shadow-lg">
                Accounting
            </a>
            <a href="/sales-report.html" className="flex-1 text-center py-1.5 px-3 rounded-md text-xs font-bold transition-all whitespace-nowrap text-gray-300 cursor-not-allowed hover:text-white">
                Sales
            </a>
            <a href="/inventory-report.html" className="flex-1 text-center py-1.5 px-3 rounded-md text-xs font-bold transition-all whitespace-nowrap text-gray-300 cursor-not-allowed hover:text-white">
                Inventory
            </a>
        </div>
    </div>
    <WeekNavigation startDate={startDate} endDate={endDate} setStartDate={setStartDate} />
</div>
<nav
  className="fixed bottom-0 left-0 w-full
             bg-white/85 backdrop-blur-[20px]
             border-t border-black/5
             flex items-center justify-around
             z-10
             pb-[env(safe-area-inset-bottom)]
             font-['Inter',sans-serif]"
>
  {/* Home */}
  <a
    href="dashboard.html"
    className="flex flex-col items-center flex-1
               text-slate-500 transition duration-200 no-underline"
  >
    <svg className="w-[22px] h-[22px] fill-none stroke-current stroke-2" viewBox="0 0 24 24">
      <rect x="3" y="3" width="7" height="7" />
      <rect x="14" y="3" width="7" height="7" />
      <rect x="14" y="14" width="7" height="7" />
      <rect x="3" y="14" width="7" height="7" />
    </svg>
    <span className="mt-1 text-[11px] font-medium">Home</span>
  </a>

  {/* Inventory (inactive) */}
  <a
    href="/inventory.html"
    className="flex flex-col items-center flex-1
               text-slate-500 no-underline"
  >
    <svg className="w-[22px] h-[22px] fill-none stroke-current stroke-2" viewBox="0 0 24 24">
      <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
      <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
      <line x1="12" y1="22.08" x2="12" y2="12" />
    </svg>
    <span className="mt-1 text-[11px] font-medium">Inventory</span>
  </a>

  {/* Reports (ACTIVE) */}
  <a
    href="#"
    className="relative flex flex-col items-center flex-1
               text-[#3f72af] no-underline"
  >
    <div
      className="absolute -top-[14px] w-[20px] h-[3px]
                 bg-[#3f72af] rounded-b"
    />

    <svg
      className="w-[22px] h-[22px]
                 fill-blue-600/10 stroke-current stroke-2"
      viewBox="0 0 24 24"
    >
      <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
      <polyline points="17 6 23 6 23 12" />
    </svg>
    <span className="mt-1 text-[11px] font-semibold">Reports</span>
  </a>

  {/* Stats */}
  <a
    href="statistics.html"
    className="flex flex-col items-center flex-1
               text-slate-500 no-underline"
  >
    <svg className="w-[22px] h-[22px] fill-none stroke-current stroke-2" viewBox="0 0 24 24">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
      <polyline points="14 2 14 8 20 8" />
      <line x1="16" y1="13" x2="8" y2="13" />
      <line x1="16" y1="17" x2="8" y2="17" />
    </svg>
    <span className="mt-1 text-[11px] font-medium">Stats</span>
  </a>

  {/* Settings */}
  <a
    href="settings.html"
    className="flex flex-col items-center flex-1
               text-slate-500 no-underline"
  >
    <svg className="w-[22px] h-[22px] fill-none stroke-current stroke-2" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="3" />
      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0-.33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0 .33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
    </svg>
    <span className="mt-1 text-[11px] font-medium">Settings</span>
  </a>
</nav>


                        <div className="flex-1 overflow-y-auto pb-24 px-5 pt-4">
                            
                            
                            
<h3 className={`
            text-3xl font-bold tracking-tight 
            
        `}>
            Accounting Reports
        </h3>

<h3 className="text-xs font- text-gray-400  tracking-wider ml-1 mt-2 pd-10">2 Reports available</h3>                            {loading && (
                                <Card className="p-4 text-center text-blue-600 font-semibold mt-4">Generating Accounting Reports...</Card>
                            )}
                            {error && (
                                <Card className="p-4 bg-red-100 text-red-800 font-semibold mt-4">{error}</Card>
                            )}

                            {!loading && accountingData && (
                                <div className="mt-5 mb-8 animate-fade-in">
                                    <Card className="p-5 bg-gray-900 rounded-xl shadow-lg border border-white/10">
    {/* Label (Soft, muted white for contrast) */}
    <p className="text-gray-400 text-xs font-medium uppercase mb-2 tracking-wider">
        Net Profit ({startDateStr} to {endDateStr})
    </p>
    
    <div className="flex items-end gap-3 border-b border-white/20 pb-3">
        {/* Value (Emphasized text color for status) */}
        <h3 className={`
            text-3xl font-extrabold tracking-tight 
            ${netProfitSummary >= 0 ? 'text-white' : 'text-red-400'}
        `}>
            K{formatK(netProfitSummary)}
        </h3></div>

<Icons.FileText size={40} className="text-white/100 mt-4 float-left" />

 <span className={`
            inline-block mt-6 px-4 py-1.5 
           bg-white/10 text-white border border-white/20
            float-right
            text-xs font-medium rounded-full uppercase
        `}>
            Final Result
        </span>
    
</Card>

                                </div>
                            )}

                            {!loading && accountingData && (
                                <div className="space-y-4 animate-fade-in">
                                    <h3 className="text-xs font-bold text-gray-400 uppercase tracking-wider ml-1">Reports</h3>
                                    <div className="bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden">
                                        {categoryData && categoryData.map((report, index) => (
                                            <div 
                                                key={report.id}
                                                onClick={() => openReport(report.id, report.title)}
                                                className={`flex items-center justify-between p-4 bg-white ${index !== categoryData.length - 1 ? 'border-b border-gray-100' : ''} active:bg-gray-50 cursor-pointer transition-colors`}
                                            >
                                                <div className="flex items-center gap-3">
                                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center ${report.color}`}>
                                                        <report.icon size={20} />
                                                    </div>
                                                    <div>
                                                        <h4 className="font-semibold text-gray-900 text-sm">{report.title}</h4>
                                                        <p className="text-xs text-gray-500">{report.sub}</p>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <Icons.ChevronRight size={16} className="text-gray-300" />
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                        </div>

                        <ReportModal 
                            isOpen={modalOpen} 
                            onClose={() => setModalOpen(false)} 
                            title={currentReport?.title || 'Report'}
                        >
                            {currentReport && <ReportContent reportId={currentReport.id} accountingData={accountingData} />}
                        </ReportModal>

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AvantiLedger />);
    </script>
</body>
</html>
